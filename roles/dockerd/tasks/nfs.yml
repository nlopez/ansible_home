---
- include_vars:
    dir: vars
    files_matching: '{{ansible_os_family}}.yml'

- name: Install NFS utils
  package:
    name: '{{nfs_utils}}'
    state: present

- name: Ensure mount points exist
  file:
    path: "{{ item.dest }}"
    state: directory
  with_items: "{{ nfs_mounts }}"
  when: nfs_mounts is defined

- name: Mount NFS shares
  mount:
    path: "{{ item.dest }}"
    src: "{{ item.src }}"
    fstype: nfs4
    state: mounted
  with_items: "{{ nfs_mounts }}"
  when: nfs_mounts is defined

- name: Start and enable rpcbind
  service:
    name: rpcbind
    enabled: yes
    state: started

