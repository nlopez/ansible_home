---
- name: Ensure the router solicitation daemon is running and enabled
  service: name=rtsold state=started enabled=yes
  when: ansible_os_family == "FreeBSD"

- include: locale.yml 

- name: Install common packages
  package: name="{{ item }}" state=present
  with_items: 
    - bash
    - zsh
    - sudo
    - rsync
    - "{{ system_certificates }}"
    - curl
    - wget
    - mosh
    - screen
    - "{{ dig }}"
    - tree
    - "{{ vim }}"

- name: Install grml zsh extras
  package: name=grml-zsh-config state=present
  when: ansible_os_family == "Archlinux"

- name: Determine path to zsh
  shell: which zsh
  register: which_zsh
  changed_when: False

- set_fact:
    zsh_binary: "{{ which_zsh.stdout | default('/usr/bin/zsh') }}"

- name: Add Nick's group
  group: name=nlopez state=present

- name: Add Nick's superuser
  user:
    name: nlopez
    shell: "{{ zsh_binary }}"
    group: nlopez
    groups: "{{ sudo_group }}"
    createhome: True

- name: Enumerate available groups
  shell: getent group | awk -F":" '{print $1}'
  register: etc_group
  changed_when: False

- name: Add Nick to docker group
  user: name=nlopez groups="{{ item }}" append=yes
  when: '"{{ item }}" in etc_group.stdout_lines'
  with_items:
    - docker

- name: Setup Nick's keys
  authorized_key:
    user: nlopez
    key: https://github.com/nlopez.keys
    exclusive: yes
    validate_certs: yes # default

- name: Allow members of sudoers group to run all commands without a password
  template: src=sudoers.j2 dest={{ sudoers }} validate='visudo -cf %s'

